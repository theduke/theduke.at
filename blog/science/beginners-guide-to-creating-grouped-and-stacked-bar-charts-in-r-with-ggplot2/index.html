<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-36849244-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-36849244-1');
    </script>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>Beginners Guide to  Creating Grouped and Stacked Bar Charts in R With ggplot2 | theduke.at</title>

    <link data-react-helmet="true" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Lora|Tangerine|Lato|Source+Sans+Pro">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="/styles.css">

    

    
    
</head>

<body>
<div>

<header class="topnav">
    <a href="/" class="topnav-brand">theDuke</a>

    <!-- <a href="/me" class="topnav-link">Me</a> -->
    <a href="/blog" class="topnav-link">Blog</a>

    <div class="topnav-social">
        <a href="https://github.com/theduke" target="_blank">
            <i class="fa fa-4 fa-github-square"></i>
        </a>

        <a href="https://twitter.com/theduke_at" target="_blank">
            <i class="fa fa-twtr-custom"></i>
        </a>
    </div>
</header>


<div class="main">
    <div class="container main-container">
        
<div class="post">
    <h1 class="page-title display-3">Beginners Guide to  Creating Grouped and Stacked Bar Charts in R With ggplot2</h1>
    <span class="post-date">2016-09-09</span>

    <div class="page-content">
        <summary>
  This tutorial will give you a step by step guide to creating grouped and stacked
  bar charts in R with ggplot2.  
  We start with a very simple bar chart, and enhance it to end up with a stacked 
  and grouped bar chart with a proper title and cutom labels.
</summary>
<p><a href="https://www.r-project.org/">R-Lang</a> is a programming language and environment
for doing all kinds of statistical analysis, and if you are interested in 
statistics, you've probably heard about it already.</p>
<p>R is free, open source, and has a huge range of packages available to do pretty 
much everything you'd ever want to do in this field: loading, transforming and 
analyzing data. And generate pretty charts and graphs. It has become a popular
alternative to expensive solutions like <a href="http://www.ibm.com/analytics/us/en/technology/spss/">SPSS</a>.</p>
<p>I took me a while to figure out how to create a bar chart with stacked bars, 
that are grouped by a certain value.</p>
<p>To make it easier, for you, I'll give a little introduction to bar charts in R,
starting with a basic bar chart, then stacking the bars, and finally arriving
at a grouped and stacked bar chart with a chart title and better labels, which 
we will save to a file.</p>
<p><strong>Please note</strong> that this is not intended as a complete introduction to R itself.
There are plenty of tutorials out there for that.
<br /><br /></p>
<h3 id="install-and-launch-r">Install and Launch R</h3>
<p>If you don't have R installed already, look for one tutorial for your platform,
or check out the <a href="https://cran.r-project.org/doc/manuals/r-release/R-admin.html">official guide</a>.</p>
<p>Then, launch the interactive R shell with the command <code>R</code>.
<br /><br /></p>
<h3 id="install-ggplot2">Install ggplot2</h3>
<p>While R has plotting functions built in, the <a href="http://ggplot2.org/">ggplot2</a>
library offers far superior capabilities and prettier results.</p>
<p>We have to install it seperatly, which is really easy, though.</p>
<p>Just execute these commands in the R shell:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#65737e;"># Install.
</span><span style="color:#bf616a;">install.package</span><span style="color:#c0c5ce;">(ggplot2)
</span><span style="color:#65737e;"># Load ggplot2.
</span><span style="color:#96b5b4;">library</span><span style="color:#c0c5ce;">(ggplot2)
</span></code></pre><br />
<h3 id="getting-some-sample-data">Getting some sample data</h3>
<p>R has a couple of datasets built in, but for simplicity, we'll just generate 
our own data.</p>
<p>We will work with a simple dataset, which we create randomly: 
*Customer data for a fictional company, including the year, continent, gender and 
amount each <strong>individual customer</strong> spent.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">d &lt;- </span><span style="color:#96b5b4;">data.frame</span><span style="color:#c0c5ce;">(
  </span><span style="color:#bf616a;">year</span><span style="color:#c0c5ce;">=</span><span style="color:#96b5b4;">factor</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">sample</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2010</span><span style="color:#b48ead;">:</span><span style="color:#d08770;">2014</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">400</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">replace</span><span style="color:#c0c5ce;">=T)), 
  </span><span style="color:#bf616a;">continent</span><span style="color:#c0c5ce;">=</span><span style="color:#96b5b4;">factor</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">sample</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">c</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">EU</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">US</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Asia</span><span style="color:#c0c5ce;">&quot;), </span><span style="color:#d08770;">400</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">replace</span><span style="color:#c0c5ce;">=T)),
  </span><span style="color:#bf616a;">gender</span><span style="color:#c0c5ce;">=</span><span style="color:#96b5b4;">factor</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">sample</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">c</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">male</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">female</span><span style="color:#c0c5ce;">&quot;), </span><span style="color:#d08770;">400</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">replace</span><span style="color:#c0c5ce;">=T)),
  </span><span style="color:#bf616a;">amount</span><span style="color:#c0c5ce;">=</span><span style="color:#96b5b4;">sample</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">20</span><span style="color:#b48ead;">:</span><span style="color:#d08770;">5000</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">400</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">replace</span><span style="color:#c0c5ce;">=T)
)

</span></code></pre>
<p>The data looks like this:</p>
<table class="table">
  <thead>
    <tr>
      <th>year</th>
      <th>continent</th>
      <th>gender</th>
      <th>amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2010</td>
      <td>US</td>
      <td>male</td>
      <td>213</td>
    </tr>
    <tr>
      <td>2011</td>
      <td>EU</td>
      <td>female</td>
      <td>3433</td>
    </tr>
    <tr>
      <td>2014</td>
      <td>Asia</td>
      <td>male</td>
      <td>213</td>
    </tr>
    <tr>
      <td>...</td>
    </tr>
  </tbody>
</table>
<br />
<h3 id="a-simple-plot-customers-per-year">A simple plot: Customers per Year</h3>
<p>Let's start of with a simple chart, showing the number of customers per year:</p>
<p>ggplot2 works in layers. First, you call the <a href="http://docs.ggplot2.org/current/ggplot.html">ggplot()</a> 
function with default settings which will be passed down.</p>
<p>Then you add the layers you want by simply adding them with the <strong>+ operator</strong>.</p>
<p>For bar charts, we will need the <a href="http://docs.ggplot2.org/current/geom_bar.html">geom_bar()</a> function.</p>
<p>The chart should just <em>pop up in a new window</em> when executing the command.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#bf616a;">ggplot</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">=d, </span><span style="color:#bf616a;">aes</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">=year, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">=amount)) + </span><span style="color:#bf616a;">geom_bar</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">stat</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">identity</span><span style="color:#c0c5ce;">&quot;)
</span></code></pre>
<p><img src="./bars_plain.png" alt="Basic Bar Chart" /></p>
<p><strong>Note that the height of the bars will be different for you, because the sample
dataset contains random values</strong>.</p>
<p>Alright, but we would like to have some colors for the bars. Let's make it pretty!<br />
All we need is to add a <code>fill</code> argument to <code>aes</code></p>
<pre style="background-color:#2b303b;">
<code><span style="color:#bf616a;">ggplot</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">=d, </span><span style="color:#bf616a;">aes</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">=year, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">=amount, </span><span style="color:#bf616a;">fill</span><span style="color:#c0c5ce;">=year)) + </span><span style="color:#bf616a;">geom_bar</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">stat</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">identity</span><span style="color:#c0c5ce;">&quot;)
</span></code></pre>
<p><img src="./bars_coloured.png" alt="Colored Bar Chart" />
<br /><br /></p>
<h3 id="stacked-bars-customers-per-year-and-gender">Stacked Bars: Customers per Year and Gender</h3>
<p>Next step: split the bars into male / female customers.<br />
All we need to do is the change <code>fill</code> to the variable we want to stack by. 
In this case, it's <em>gender</em>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#bf616a;">ggplot</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">=d, </span><span style="color:#bf616a;">aes</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">=year, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">=amount, </span><span style="color:#bf616a;">fill</span><span style="color:#c0c5ce;">=gender)) + </span><span style="color:#bf616a;">geom_bar</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">stat</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">identity</span><span style="color:#c0c5ce;">&quot;)
</span></code></pre>
<p><img src="./bars_stacked_unsorted.png" alt="Basic Bar Chart" /></p>
<p><strong>Huh? That looks weird! <em>What happened?</em></strong></p>
<p>Well, the data is displayed as is, unsorted, and so we get inter-dispersed &quot;male&quot; 
and &quot;female&quot; values.</p>
<p>To fix it, we have to <strong>sort the data</strong> with the <code>order</code> function:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#65737e;"># Sort the data first:
</span><span style="color:#c0c5ce;">d &lt;- </span><span style="color:#96b5b4;">with</span><span style="color:#c0c5ce;">(d, d[</span><span style="color:#96b5b4;">order</span><span style="color:#c0c5ce;">(year, gender),])
</span><span style="color:#bf616a;">ggplot</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">=d, </span><span style="color:#bf616a;">aes</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">=year, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">=amount, </span><span style="color:#bf616a;">fill</span><span style="color:#c0c5ce;">=gender)) + </span><span style="color:#bf616a;">geom_bar</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">stat</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">identity</span><span style="color:#c0c5ce;">&quot;)
</span></code></pre>
<p><img src="./bars_stacked_sorted.png" alt="Basic Bar Chart" /></p>
<p>Ahh, there we go. Much better!
<br /><br /></p>
<h3 id="grouped-and-stacked-bars">Grouped and Stacked Bars</h3>
<p>Alright, almost there. Now we want to show data for each continent in a separate 
bar and group them by year.<br />
Turns out this is just another function call away. We need to use
<a href="http://docs.ggplot2.org/0.9.3.1/facet_grid.html">facet_grid</a>.</p>
<p>We change the <strong>x axis to show the continent</strong> rather then the year.
Then we <strong>group into years with facet_grid</strong>.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#65737e;"># Sort data.
</span><span style="color:#c0c5ce;">d &lt;- </span><span style="color:#96b5b4;">with</span><span style="color:#c0c5ce;">(d, d[</span><span style="color:#96b5b4;">order</span><span style="color:#c0c5ce;">(year, gender, continent),])
</span><span style="color:#bf616a;">ggplot</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">=d, </span><span style="color:#bf616a;">aes</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">=continent, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">=amount, </span><span style="color:#bf616a;">fill</span><span style="color:#c0c5ce;">=gender)) + 
  </span><span style="color:#bf616a;">geom_bar</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">stat</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">identity</span><span style="color:#c0c5ce;">&quot;) + 
  </span><span style="color:#bf616a;">facet_grid</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">~</span><span style="color:#c0c5ce;">year)
</span></code></pre>
<p><img src="./bars_grouped_stacked.png" alt="Basic Bar Chart" /></p>
<p>Bingo, that's what we wanted.
<br /><br /></p>
<h3 id="finishing-up-chart-title-and-labels">Finishing Up: Chart Title and Labels</h3>
<p>To finish it up, we want a nice big <strong>chart title</strong> and better <strong>labels</strong> for the axis 
and the legend on the right.</p>
<p>For this we need the <a href="http://docs.ggplot2.org/0.9.3.1/facet_grid.html">labs</a>
function. For increasing the font size and adding some margins around the title, 
we use  <a href="http://docs.ggplot2.org/0.9.3.1/theme.html">theme</a> to customize the rendering.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#bf616a;">ggplot</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">=d, </span><span style="color:#bf616a;">aes</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">=continent, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">=amount, </span><span style="color:#bf616a;">fill</span><span style="color:#c0c5ce;">=gender)) + 
  </span><span style="color:#bf616a;">geom_bar</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">stat</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">identity</span><span style="color:#c0c5ce;">&quot;) +
  </span><span style="color:#bf616a;">facet_grid</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">~</span><span style="color:#c0c5ce;">year) + 
  </span><span style="color:#bf616a;">labs</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">title</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">Customer Analysis 2010-2014</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">=&quot;&quot;, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">$ Spent / Year</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">fill</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">Gender</span><span style="color:#c0c5ce;">&quot;) + 
  </span><span style="color:#bf616a;">theme</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">plot.title </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">element_text</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">25</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">margin</span><span style="color:#c0c5ce;">=</span><span style="color:#bf616a;">margin</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">t</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">b</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">)))
</span></code></pre>
<p><img src="./bars_prettified.png" alt="Chart with Title and Labels" /></p>
<p>Pretty decent result. Especially considering how easy it was.
<br /><br /></p>
<h3 id="saving-our-chart-to-a-file">Saving our chart to a file</h3>
<p>We have the perfect chart now and want to save it to a file.</p>
<p><a href="http://docs.ggplot2.org/0.9.3.1/ggsave.html">ggsave</a> makes this really easy:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#65737e;"># Save the plot to a variable
</span><span style="color:#c0c5ce;">p &lt;- </span><span style="color:#bf616a;">ggplot</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">...</span><span style="color:#c0c5ce;">) </span><span style="color:#b48ead;">...
</span><span style="color:#65737e;"># Save to file.
# Size will be 800*600 pixels.
</span><span style="color:#bf616a;">ggsave</span><span style="color:#c0c5ce;">(p, </span><span style="color:#bf616a;">file</span><span style="color:#c0c5ce;">=&quot;</span><span style="color:#a3be8c;">chart.png</span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">width</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">8</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">height</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">6</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">dpi</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">100</span><span style="color:#c0c5ce;">)
</span></code></pre><br />
<h3 id="conclusion">Conclusion</h3>
<p>As you can see, it's pretty straight-forward to create good looking, complex
charts in R with just a few commands, thanks to the amazing libraries people
have built on top of R.</p>
<p>ggplot2 has plenty more chart types on offer. Just start browsing the 
<a href="http://docs.ggplot2.org/current/">ggplot2 documentation</a> to explore.</p>
<p>If you liked this tutorial, comment, share, and watch out for future 
tutorials and posts on R on this blog.
<br /><br /></p>
<h3 id="references">References</h3>
<ul>
<li>R project page: <a href="http://r-project.org">http://r-project.org</a></li>
<li>ggplot2: <a href="http://ggplot2.org/">http://ggplot2.org</a></li>
<li>ggplot2 documentation: <a href="http://docs.ggplot2.org/current/">http://docs.ggplot2.org/current/</a></li>
<li>Sorting data with order: <a href="http://rprogramming.net/r-order-to-sort-data/">http://rprogramming.net/r-order-to-sort-data</a></li>
</ul>

    </div>

    
    
<div class="disqus">
    <div id="disqus_thread"></div>

    <script>
    var disqus_config = function () {
        this.page.url = "http://theduke.at";
        this.page.identifier = "e3b1e6dd-8520-425e-8afe-aca23e71ba28";
    };
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://the-duke.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

    
</div>

    </div>
</div>

<footer class="footer">
    <a href="/">theduke.at</a>
    | &#xA9; Christoph Herzog (theduke),  2017 | Vienna, Austria
</footer>

</div>
</body>

</html>
